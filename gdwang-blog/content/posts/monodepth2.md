---
title: "Monodepth2"
date: 2023-03-02T14:19:13+08:00
draft: false
---




# 单目深度估计可行性

* 摄影变换近大远小的关系；
* 景深带来的模糊感；
* 被遮挡物深度一定更远；

单帧的单目估计存在歧义性，是一个病态问题，无法通过构建三角化求解相应深度；

单眼在生活中可以有基本的距离感知能力，通过深度学习进行单目深度估计是可行的；

# 联合估计
联合相机估计与单目深度估计，提升单目深度估计的精度。单目深度估计，估计相对逆深度， 逆深度值 [0, 1]

相机位姿估计

损失函数， 利用相机位姿与视差， 计算亮度投影误差

## 逆深度估计模块
估计每个像素点的逆深度，有了逆深度取导数即可恢复深度；

估计的逆深度值范围在[0, 1之间，与真实深度存在一个比例因子，只表示相机与场景间的相对距离；

### a.特征编码
ResNet-18模型结构
对输入图像进行32倍下采样，生成5级特征， 从上到下，级数越高，空间分辨率越低；特征个数越多，chn越多；
### b.特征解码
从第五级，联合编码器中相同分辨率特征进行深度估计，上采样，  
输出1-4级逆深度map；第一级分辨率与原图分辨率一致；

# 相机位姿模块
基于连续帧图像间的变化，估计相机位姿；
## 编码器
与单目估计一致

## 解码器
取第五级特征，空间分辨率最低，抽象能力最强feat map，送入到解码器估计位姿；  
解码器为3层卷积结构， 回归出每个像素点的位姿信息；  
输入[256， h， w]  
输出 [12， h， w]  
对 h, w求均值，获得连续帧之间的轴角与平移， 从轴借助罗德里格斯公式恢复R；  

# 损失函数

## 单目遮挡情况下的匹配损失函数
常规无监督损失函数，采样计算亮度的重投影误差的方式，（单目深度估计，光流，立体匹配）。

基于深度值与相机位姿对源图像采样， 与目标图像对比；计算相似性；
$$
L_p = \sum_{t'}pe(I_t, I_{t'})
$$

$$
I_{t'\rightarrow t} = I_t'\left(reproj(D, T_{t\rightarrow t'}, K) \right)
$$

$$
pe(I_t, I_{t'}) = \frac{\alpha}{2}(1-SSIM(I_t, I_{t'})) + (1-\alpha)|| I_t - I_{t'}||_1
$$

重投影坐标
$$
reproj(D, T_{t\rightarrow t'}, K) = \phi(KT_{t\rightarrow t'}DK^{-1}p)
$$
$\phi$ 表示转化为齐次坐标

利用相机位姿与深度对源图像采样获得目标图像上的采样坐标，目标图像与采样图像亮度应该保持一致；

通过训练，优化重投影误差，学习深度与相机位姿模型；





## 遮挡
存在遮挡的情况下，不存在匹配点对，重投影误差失效，出现外点；

改进方式

用最小值取代平均操作；是重投影误差忽略遮挡区不正确的亮度值；
$$
L_p = \min_{t'}pe(I_t, I_{t'})
$$
$\phi$ 表示转化为齐次坐标


## 假设
单目深度估计需要假设：场景静止，相机运动；

在运动场景下， 不适用


# 代码细节

# further consider
无监督的单目深度估计

1. 单目深度估计提高精度；  
与位姿估计结合；  

位姿估计能否有监督  
有监督， 使用IMU传感器    
外参数  

vit depth

2. 提高鲁棒性  
与 vit 结合



